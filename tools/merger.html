<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="https://github.com/ThatOneUnoriginal/ThatOneUnoriginal.github.io/raw/refs/heads/main/assets/Icons/Merger_Website_Logo.ico">
    <meta property="og:title" content="T1U Tools: Save Merger">
    <meta content="A tool that allows you to merge two save files from the character bookmarking website. Includes the ability to remove invalid links, nsfw and automatically removes duplicate tiles." property="og:description" />
    <meta content="https://thatoneunoriginal.github.io/tools/merger" property="og:url" />
    <meta content="https://thatoneunoriginal.github.io/assets/Icons/png%20logos/merger.png" property="og:image" />
    <meta content="#4901FC" data-react-helmet="true" name="theme-color" />
    <title>Merger Tool: T1U Tools</title>
    <style>
.info-grid-buttons {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 15px;
}

.info-grid-buttons button {
  background-color: #007BFF;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.info-grid-buttons button:hover {
  background-color: #0056b3;
}

body.dark-mode .info-grid-buttons button {
  background-color: #007BFF;
}

body.amoled-mode .info-grid-buttons button {
  background-color: #007BFF;
}

.container {
  background: #f9f9f9;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
  width: 90vw;
  max-width: 90%;
  text-align: center;
  max-height: 90vh;
  overflow: auto;
}


body.dark-mode {
  background: linear-gradient(to right, #1a1a1a, #2d2d2d);
  color: #f0f0f0;
}

body.amoled-mode {
  background: #000000;
  color: #ffffff;
}

body.dark-mode .container, body.dark-mode .modal-content {
  background: #2d2d2d;
  box-shadow: 0 8px 20px rgba(255, 255, 255, 0.1);
}

body.amoled-mode .container, body.amoled-mode .modal-content {
  background: #1a1a1a;
  box-shadow: 0 8px 20px rgba(255, 255, 255, 0.1);
}

@keyframes float {
  0% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-10px);
  }
  100% {
    transform: translateY(0px);
  }
}

h1 {
  font-size: 2.5em;
  margin-bottom: 20px;
  color: #444;
  letter-spacing: 1px;
}

body.dark-mode h1 {
  color: #f0f0f0;
}

body.amoled-mode h1 {
  color: #ffffff;
}

button {
  background-color: #007BFF;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s ease;
  margin-top: 10px;
  width: 100%;
  max-width: 200px;
}

button:hover {
  background-color: #0056b3;
}

body.dark-mode button:hover {
  background-color: #0056b3;
}

body.amoled-mode button:hover {
  background-color: #0056b3;
}

#fileButton2, #fileButton1{
  background-color: #1d4ccf;
  border: 2px solid #1d4ccf;
  width: 100% !important;
}


#ejectFile1, #ejectFile2{
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

#ejectFile1:disabled, #ejectFile2:disabled {
  background-color: transparent;
  border: 2px dotted #dc3545;
}

#ejectFile1:not(:disabled), #ejectFile2:not(:disabled) {
  background-color: #dc3545;
  border: 2px solid #dc3545;
}

#fileButton2:hover, #fileButton1:hover{
  background-color: #1842b6;
  border-color: #1842b6;
}

body.dark-mode button {
  background-color: #007BFF;
}

body.amoled-mode button {
  background-color: #007BFF;
}

#saveButton {
  display: none;
}

pre {
  text-align: left;
  background: #f4f4f4;
  padding: 10px;
  border-radius: 6px;
  overflow-x: auto;
  max-height: 300px;
  white-space: pre-wrap;
  word-wrap: break-word;
  transition: background-color 0.3s ease, color 0.3s ease;
  display: block;
  font-size: 14px;
}

body.dark-mode pre {
  background-color: #2d2d2d;
  color: white;
}

body.amoled-mode pre {
  background-color: #000000;
  color: white;
}

.dark-mode-toggle {
  background-color: #007BFF;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s ease;
  margin-top: 10px;
}

.output-controls {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 10px;
}

.collapse-expand-button {
  background-color: #007BFF;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 5px 10px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.collapse-expand-button:hover {
  background-color: #0056b3;
}

body.dark-mode .collapse-expand-button {
  background-color: #007BFF;
}

body.amoled-mode .collapse-expand-button {
  background-color: #007BFF;
}

.collapsed {
  display: none;
}

/* Popup Modal Styles */
.modal {
  display: none;
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.4);
  justify-content: center;
  align-items: center;
}

.modal-content {
  background-color: var(--background);
  margin: 10% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
  max-width: 500px;
  max-height: 80vh;
  overflow-y: auto;
  border-radius: 12px;
  text-align: center;
}

* {
  box-sizing: border-box;
}

.modal button {
  background-color: #007BFF;
  border: none;
  color: white;
  padding: 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
  margin: 5px;
  width: auto;
}

.file-group {
  display: flex;
  align-items: center;
  gap: 10px; /* Adjusts the spacing between buttons */
  margin-bottom: 15px; /* Adds space between file groups */
}

.file-group button {
  flex: 1; /* Ensures buttons take equal space */
}

.modal button:hover {
  background-color: #0056b3;
}

@media (max-width: 600px) {
  body {
    padding: 10px;
    max-height: 100vh;
    overflow: auto;
  }

  .container {
    padding: 15px;
    max-width: 100%;
    max-height: calc(100vh - 40px);
    overflow: auto;
  }

  .modal-content {
    max-width: 90%;
    max-height: 90vh;
    padding: 15px;
  }

  input[type="file"],
  button {
    font-size: 14px;
    padding: 8px;
  }

  pre {
    font-size: 12px;
  }
}

button {
  width: 100%;
  max-width: 100%;
  font-size: 16px;
  padding: 10px;
  box-sizing: border-box;
  margin: 10px 0;
}

pre {
  max-height: 300px;
  overflow-y: auto;
  word-wrap: break-word;
  font-size: 14px;
}

.modal-content {
  width: 90%;
  padding: 15px;
}

.modal button {
  font-size: 14px;
  padding: 8px;
}

body {
  font-family: "Arial", sans-serif;
  background: linear-gradient(to right, #f0f0f0, #f9f9f9);
  background-size: 200% 100%;
  animation: gradientAnimation 10s ease infinite;
  --background: #fff;
  margin: 0;
  padding: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  max-height: 100vh;
  overflow: hidden;
  color: #333;
  transition: background-color 0.3s ease, color 0.3s ease;
}

.mobile-button {
  display: none;
}

@media (max-width: 600px) {
  .mobile-button {
    display: flex;
    margin: 10px 0;
  }

  .desktop-button {
    display: none;
  }
}

    </style>
</head>
<body>
    <div class="container">
        <h1>JSON Merger (with Duplicate Removal)</h1>
        <div class="info-grid-buttons">
          <button class="desktop-button" onclick="showInfo()">Info</button>
          <button class="desktop-button" onclick="goToGrid()">Go to Grid</button>
          <button class="desktop-button" onclick="goToGrid1()">Go to Reorder Tool</button>
        </div>
        <button class="mobile-button" onclick="showInfoMobile()">Info</button>
        <button class="mobile-button" onclick="goToGridMobile()">Go to Grid</button>
        <button class="mobile-button" onclick="goToGrid1Mobile()">Go to Reorder Tool</button>
        <div class="file-group">
          <button id="fileButton1" onclick="document.getElementById('file1').click()">Input File One Here</button>
          <input type="file" id="file1" accept=".json" style="display:none;" onchange="updateButtonText(this, 'fileButton1')">
          <button id="ejectFile1" onclick="ejectFile('file1', 'fileButton1', 'ejectFile1')" disabled>Eject File One</button>
        </div>

        <div class="file-group">
          <button id="fileButton2" onclick="document.getElementById('file2').click()">Input File Two Here</button>
          <input type="file" id="file2" accept=".json" style="display:none;" onchange="updateButtonText(this, 'fileButton2')">
          <button id="ejectFile2" onclick="ejectFile('file2', 'fileButton2', 'ejectFile2')" disabled>Eject File Two</button>
        </div>
        <button onclick="mergeJSON()">Merge JSON</button>
        <button id="saveButton" onclick="saveJSON()">Save Merged JSON</button>
        <button id="clearButton" onclick="clearData()">Clear Data</button>
        <button class="dark-mode-toggle" onclick="toggleTheme()">Toggle Dark Mode</button>
        <pre id="output"></pre>
      </div>
      <!-- Modal -->
      <div id="nsfwModal" class="modal">
        <div class="modal-content">
          <h2>Warning: NSFW Content</h2>
          <p>Some of the data contains "18+" content. Do you want to proceed?</p>
          <button onclick="handleNSFW(true)">Proceed</button>
          <button onclick="handleNSFW(false)">Remove NSFW</button>
        </div>
      </div>
      <div id="invalidLinkModal" class="modal">
        <div class="modal-content">
          <h2>Warning: Invalid Links</h2>
          <p>Some items don't have valid hyperlinks. Do you want to remove them?</p>
          <button onclick="handleInvalidLinks(true)">Remove Invalid Links</button>
          <button onclick="handleInvalidLinks(false)">Keep All</button>
        </div>
      </div>
      <div id="infoModal" class="modal">
        <div class="modal-content">
          <h2>Information</h2>
          <p>
            <strong>What is this tool?</strong>
          </p>
          <p>Ever wanted to share characters from your Character Bookmarking List but keep your existing tiles intact? This tool allows you to <strong>merge two JSON backup files</strong>, combining characters from both into a single file that can be easily imported. </p>
          <p>
            <strong>How to Combine Files?</strong>
          </p>
          <ol>
            <li>
              <strong>Obtain Two JSON Files:</strong> Make sure you have two compatible JSON files from the bookmarking tool. You can export your own backup file using the export button on the bookmarking website.
            </li>
            <li>
              <strong>Upload Files:</strong> Upload each file into the provided file input boxes. The order doesn’t matter, but ensure that each file goes into its respective box.
            </li>
            <li>
              <strong>Merge Files:</strong> After uploading, click the <strong>Merge JSON</strong> button. If successful, the combined data will appear in the output window at the bottom. Be aware of any warnings/notices before the merged data is displayed.
            </li>
            <li>
              <strong>Save the Merged File:</strong> Once the merge is complete, a <strong>Save Merged JSON</strong> button will appear, allowing you to download the final merged file to your device.
            </li>
          </ol>
          <p>
            <strong>What Are These Notices/Warnings?</strong>
          </p>
          <ul>
            <li>
              <strong>NSFW Content:</strong> If either file contains characters marked as "18+", you’ll see this warning. <br> - <strong>Proceed:</strong> Keeps NSFW characters. <br> - <strong>Remove NSFW:</strong> Removes all NSFW characters from both files.
            </li>
            <li>
              <strong>Invalid Links:</strong> If characters without hyperlinks are detected, this warning will appear. <br> - <strong>Keep All:</strong> Keeps all characters, including those without valid links. <br> - <strong>Remove Invalid Links:</strong> Removes characters without valid hyperlinks.
            </li>
          </ul>
          <p>
            <strong>Why Are Some Characters Missing?</strong>
          </p>
          <p>Even if you don't remove NSFW content or invalid links, <strong>duplicate tiles</strong> are automatically filtered out based on their hyperlinks. If two tiles have the same link (e.g., both point to "https://youtube.com"), only one will be kept in the final merged file. </p>
          <button onclick="closeInfoModal()">Close</button>
        </div>
      </div>
    <script>
let mergedData = null;
let nsfwData = [];
const nsfwTags = ["18+", "NSFW", "Porn", "Hentai"];

function mergeJSON() {
    const file1 = document.getElementById('file1').files[0];
    const file2 = document.getElementById('file2').files[0];

    if (!file1 || !file2) {
        alert('Please select two JSON files');
        return;
    }

    const reader1 = new FileReader();
    const reader2 = new FileReader();

    reader1.onload = (e1) => {
        reader2.onload = (e2) => {
            try {
                const json1 = JSON.parse(e1.target.result);
                const json2 = JSON.parse(e2.target.result);

                const combined = [...json1, ...json2];
                const uniqueMap = new Map();

                combined.forEach((item) => {
                    if (!uniqueMap.has(item.link)) {
                        uniqueMap.set(item.link, item);
                    }
                });

                mergedData = Array.from(uniqueMap.values()).map((item) => ({
                    imageData: item.imageData || "",
                    link: item.link || "https://",
                    tags: Array.isArray(item.tags) ? item.tags : [],
                    platform: item.platform || "",
                    name: item.name || "",
                    description: item.description || "",
                    age: item.age || ""
                }));

                checkForNSFWContent(mergedData);
            } catch (error) {
                alert('Error processing JSON: ' + error.message);
            }
        };
        reader2.readAsText(file2);
    };
    reader1.readAsText(file1);
}

function checkForNSFWContent(data) {
    nsfwData = data.filter((item) =>
        item.tags.some((tag) => nsfwTags.includes(tag))
    );

    if (nsfwData.length > 0) {
        toggleModal('nsfwModal', true);
    } else {
        checkForInvalidLinks(data);
    }
}

function handleNSFW(allow) {
    toggleModal('nsfwModal', false);

    const filteredData = allow ?
        mergedData :
        mergedData.filter(
            (item) => !item.tags.some((tag) => nsfwTags.includes(tag))
        );

    checkForInvalidLinks(filteredData);
}

function isValidURL(url) {
    try {
        const validURL = new URL(url);
        const domainParts = validURL.hostname.split('.');
        return (
            (validURL.protocol === "http:" || validURL.protocol === "https:") &&
            domainParts.length > 1
        );
    } catch {
        return false;
    }
}

function checkForInvalidLinks(data) {
    const invalidLinkData = data.filter(
        (item) => !isValidURL(item.link) || item.link === "https://"
    );

    if (invalidLinkData.length > 0) {
        toggleModal('invalidLinkModal', true);
    } else {
        displayMergedData(data);
    }
}

function handleInvalidLinks(remove) {
    toggleModal('invalidLinkModal', false);

    const filteredData = remove ?
        mergedData.filter(
            (item) => isValidURL(item.link) && item.link !== "https://"
        ) :
        mergedData;

    displayMergedData(filteredData);
}

function displayMergedData(data) {
    mergedData = data;
    document.getElementById('output').textContent = JSON.stringify(data, null, 2);
    document.getElementById('saveButton').style.display = 'inline-block';
}

function saveJSON() {
    if (!mergedData) {
        alert('No merged data to save. Please merge JSON files first.');
        return;
    }

    const currentUnixTime = Math.floor(Date.now() / 1000);
    const randomizedUnixTime = currentUnixTime + Math.floor(Math.random() * 1000); // Randomize by adding a random number between 0 and 999
    const filename = `T1UToolsMerger${currentUnixTime}${randomizedUnixTime}.json`;

    const dataStr = `data:text/json;charset=utf-8,${encodeURIComponent(
        JSON.stringify(mergedData)
    )}`;
    const downloadAnchorNode = document.createElement('a');
    downloadAnchorNode.setAttribute("href", dataStr);
    downloadAnchorNode.setAttribute("download", filename);
    document.body.appendChild(downloadAnchorNode);
    downloadAnchorNode.click();
    downloadAnchorNode.remove();
}

function clearData() {
    mergedData = null;
    document.getElementById('output').textContent = '';
    document.getElementById('file1').value = '';
    document.getElementById('file2').value = '';
    document.getElementById('saveButton').style.display = 'none';
    updateButtonText(document.getElementById('file1'), 'fileButton1');
    updateButtonText(document.getElementById('file2'), 'fileButton2');
    document.getElementById('ejectFile1').disabled = true;
    document.getElementById('ejectFile2').disabled = true;
}

function toggleTheme() {
    const body = document.body;
    const currentTheme = localStorage.getItem('preferred-theme');
    let newTheme;

    if (currentTheme === 'dark') {
        newTheme = 'amoled';
    } else if (currentTheme === 'amoled') {
        newTheme = 'light';
    } else {
        newTheme = 'dark';
    }

    body.classList.remove('dark-mode', 'amoled-mode');
    if (newTheme === 'dark') {
        body.classList.add('dark-mode');
    } else if (newTheme === 'amoled') {
        body.classList.add('amoled-mode');
    }

    localStorage.setItem('preferred-theme', newTheme);

    const toggleButton = document.querySelector('.dark-mode-toggle');
    if (toggleButton) {
        toggleButton.textContent = newTheme === 'light' ? 'Toggle Dark Mode' : (newTheme === 'amoled' ? 'Toggle Light Mode' : 'Toggle AMOLED Mode');
    }
}

document.addEventListener('DOMContentLoaded', () => {
    // Existing theme code
    const preferredTheme = localStorage.getItem('preferred-theme');
    const body = document.body;
    if (preferredTheme === 'dark') {
        body.classList.add('dark-mode');
    } else if (preferredTheme === 'amoled') {
        body.classList.add('amoled-mode');
    }

    const toggleButton = document.querySelector('.dark-mode-toggle');
    if (toggleButton) {
        toggleButton.textContent = preferredTheme === 'light' ? 'Toggle Dark Mode' : (preferredTheme === 'amoled' ? 'Toggle Light Mode' : 'Toggle AMOLED Mode');
    }

    // Add this new code to ensure eject buttons start disabled
    document.getElementById('ejectFile1').disabled = true;
    document.getElementById('ejectFile2').disabled = true;
});

function toggleModal(modalId, show) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = show ? "block" : "none";
    }
}

function showInfo() {
    toggleModal('infoModal', true);
}

function closeInfoModal() {
    toggleModal('infoModal', false);
}

function goToGrid(url) {
    window.location.href = url;
}

function updateButtonText(input, buttonId) {
    const button = document.getElementById(buttonId);
    if (input.files.length > 0) {
        button.textContent = `File Imported: ${input.files[0].name}`;
        button.style.backgroundColor = 'green';
        button.style.borderColor = 'green';
        document.getElementById(`ejectFile${buttonId.slice(-1)}`).disabled = false;
    } else {
        button.textContent = buttonId === 'fileButton1' ? 'Input File One Here' : 'Input File Two Here';
        button.style.backgroundColor = '#007BFF';
        document.getElementById(`ejectFile${buttonId.slice(-1)}`).disabled = true;
    }
}

function ejectFile(fileInputId, buttonId, ejectButtonId) {
    const fileInput = document.getElementById(fileInputId);
    const button = document.getElementById(buttonId);
    const ejectButton = document.getElementById(ejectButtonId);

    fileInput.value = '';
    button.textContent = buttonId === 'fileButton1' ? 'Input File One Here' : 'Input File Two Here';
    button.style.backgroundColor = ''; // Reset background color
    button.style.cssText = ''; // Reset all inline styles
    ejectButton.disabled = true;
}


function goToGrid() {
    window.location.href = 'https://thatoneunoriginal.github.io/tools/bookmarks/character';
}

function goToGrid1() {
    window.location.href = 'https://thatoneunoriginal.github.io/tools/shuffler';
}

function goToGridMobile() {
    window.location.href = 'https://thatoneunoriginal.github.io/tools/bookmarks/character';
}

function goToGrid1Mobile() {
    window.location.href = 'https://thatoneunoriginal.github.io/tools/shuffler';
}

    </script>
</body>
</html>
